{"ast":null,"code":"var _jsxFileName = \"/Users/jwono/Downloads/snowping-pwa/src/components/MapComponent.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport './MapComponent.css';\nimport { formatDateTimeWithRelative } from '../utils/timeUtils';\n\n// Fix for default markers in Leaflet with React\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png'\n});\nconst MapComponent = ({\n  pings = [],\n  currentUserId,\n  onDeletePing\n}) => {\n  _s();\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  useEffect(() => {\n    if (!mapInstanceRef.current && mapRef.current) {\n      // Initialize map\n      mapInstanceRef.current = L.map(mapRef.current).setView([-37.1, 147.1], 13);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '¬© OpenStreetMap contributors',\n        maxZoom: 18\n      }).addTo(mapInstanceRef.current);\n    }\n\n    // Set up global delete function for popup buttons\n    window.deletePing = pingId => {\n      if (window.confirm('Are you sure you want to delete this ping?')) {\n        onDeletePing(pingId);\n      }\n    };\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n      // Clean up global function\n      delete window.deletePing;\n    };\n  }, [onDeletePing]);\n  useEffect(() => {\n    if (!mapInstanceRef.current) return;\n\n    // Clear existing markers\n    markersRef.current.forEach(marker => {\n      mapInstanceRef.current.removeLayer(marker);\n    });\n    markersRef.current = [];\n\n    // Add new markers\n    pings.forEach(ping => {\n      const icon = getPingIcon(ping.type);\n      const marker = L.marker([ping.latitude, ping.longitude], {\n        icon\n      }).addTo(mapInstanceRef.current).bindPopup(createPopupContent(ping));\n      markersRef.current.push(marker);\n    });\n\n    // Auto-fit map to show all pings\n    if (pings.length > 0) {\n      const group = new L.featureGroup(markersRef.current);\n      mapInstanceRef.current.fitBounds(group.getBounds().pad(0.1));\n    }\n  }, [pings]);\n  const getPingIcon = type => {\n    const iconConfig = {\n      iconSize: [32, 32],\n      iconAnchor: [16, 32],\n      popupAnchor: [0, -32]\n    };\n    switch (type) {\n      case 'here':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-here\">üìç</div>',\n          className: 'custom-ping-icon'\n        });\n      case 'meet':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-meet\">ü§ù</div>',\n          className: 'custom-ping-icon'\n        });\n      case 'sos':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-sos\">üÜò</div>',\n          className: 'custom-ping-icon'\n        });\n      default:\n        return new L.Icon.Default();\n    }\n  };\n  const createPopupContent = ping => {\n    const timeWithRelative = formatDateTimeWithRelative(ping.timestamp);\n    const typeEmoji = {\n      here: 'üìç',\n      meet: 'ü§ù',\n      sos: 'üÜò'\n    };\n    const isOwnPing = ping.user_id === currentUserId;\n    const canDelete = isOwnPing && (ping.type === 'here' || ping.type === 'meet');\n    return `\n      <div class=\"ping-popup\" data-ping-id=\"${ping.id}\">\n        <div class=\"ping-popup-header\">\n          <span class=\"ping-popup-icon\">${typeEmoji[ping.type] || 'üìç'}</span>\n          <span class=\"ping-popup-type\">${ping.type.toUpperCase()}</span>\n          ${canDelete ? `<button class=\"ping-delete-btn\" onclick=\"window.deletePing('${ping.id}')\" title=\"Delete this ping\">üóëÔ∏è</button>` : ''}\n        </div>\n        <div class=\"ping-popup-user\">üë§ ${ping.username || 'Anonymous'}</div>\n        ${ping.message ? `<div class=\"ping-popup-message\">${ping.message}</div>` : ''}\n        <div class=\"ping-popup-time\">${timeWithRelative}</div>\n      </div>\n    `;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mapRef,\n    className: \"map-container\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 10\n  }, this);\n};\n_s(MapComponent, \"HfxYcnpQhQPTJOnowaWcPQZAg+0=\");\n_c = MapComponent;\nexport default MapComponent;\nvar _c;\n$RefreshReg$(_c, \"MapComponent\");","map":{"version":3,"names":["React","useEffect","useRef","L","formatDateTimeWithRelative","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","MapComponent","pings","currentUserId","onDeletePing","_s","mapRef","mapInstanceRef","markersRef","current","map","setView","tileLayer","attribution","maxZoom","addTo","window","deletePing","pingId","confirm","remove","forEach","marker","removeLayer","ping","icon","getPingIcon","type","latitude","longitude","bindPopup","createPopupContent","push","length","group","featureGroup","fitBounds","getBounds","pad","iconConfig","iconSize","iconAnchor","popupAnchor","divIcon","html","className","timeWithRelative","timestamp","typeEmoji","here","meet","sos","isOwnPing","user_id","canDelete","id","toUpperCase","username","message","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/jwono/Downloads/snowping-pwa/src/components/MapComponent.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react'\nimport L from 'leaflet'\nimport 'leaflet/dist/leaflet.css'\nimport './MapComponent.css'\nimport { formatDateTimeWithRelative } from '../utils/timeUtils'\n\n// Fix for default markers in Leaflet with React\ndelete L.Icon.Default.prototype._getIconUrl\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n})\n\nconst MapComponent = ({ pings = [], currentUserId, onDeletePing }) => {\n  const mapRef = useRef(null)\n  const mapInstanceRef = useRef(null)\n  const markersRef = useRef([])\n\n  useEffect(() => {\n    if (!mapInstanceRef.current && mapRef.current) {\n      // Initialize map\n      mapInstanceRef.current = L.map(mapRef.current).setView([-37.1, 147.1], 13)\n      \n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '¬© OpenStreetMap contributors',\n        maxZoom: 18,\n      }).addTo(mapInstanceRef.current)\n    }\n\n    // Set up global delete function for popup buttons\n    window.deletePing = (pingId) => {\n      if (window.confirm('Are you sure you want to delete this ping?')) {\n        onDeletePing(pingId)\n      }\n    }\n\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove()\n        mapInstanceRef.current = null\n      }\n      // Clean up global function\n      delete window.deletePing\n    }\n  }, [onDeletePing])\n\n  useEffect(() => {\n    if (!mapInstanceRef.current) return\n\n    // Clear existing markers\n    markersRef.current.forEach(marker => {\n      mapInstanceRef.current.removeLayer(marker)\n    })\n    markersRef.current = []\n\n    // Add new markers\n    pings.forEach(ping => {\n      const icon = getPingIcon(ping.type)\n      const marker = L.marker([ping.latitude, ping.longitude], { icon })\n        .addTo(mapInstanceRef.current)\n        .bindPopup(createPopupContent(ping))\n\n      markersRef.current.push(marker)\n    })\n\n    // Auto-fit map to show all pings\n    if (pings.length > 0) {\n      const group = new L.featureGroup(markersRef.current)\n      mapInstanceRef.current.fitBounds(group.getBounds().pad(0.1))\n    }\n  }, [pings])\n\n  const getPingIcon = (type) => {\n    const iconConfig = {\n      iconSize: [32, 32],\n      iconAnchor: [16, 32],\n      popupAnchor: [0, -32],\n    }\n\n    switch (type) {\n      case 'here':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-here\">üìç</div>',\n          className: 'custom-ping-icon'\n        })\n      case 'meet':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-meet\">ü§ù</div>',\n          className: 'custom-ping-icon'\n        })\n      case 'sos':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-sos\">üÜò</div>',\n          className: 'custom-ping-icon'\n        })\n      default:\n        return new L.Icon.Default()\n    }\n  }\n\n  const createPopupContent = (ping) => {\n    const timeWithRelative = formatDateTimeWithRelative(ping.timestamp)\n    const typeEmoji = {\n      here: 'üìç',\n      meet: 'ü§ù',\n      sos: 'üÜò'\n    }\n    \n    const isOwnPing = ping.user_id === currentUserId\n    const canDelete = isOwnPing && (ping.type === 'here' || ping.type === 'meet')\n    \n    return `\n      <div class=\"ping-popup\" data-ping-id=\"${ping.id}\">\n        <div class=\"ping-popup-header\">\n          <span class=\"ping-popup-icon\">${typeEmoji[ping.type] || 'üìç'}</span>\n          <span class=\"ping-popup-type\">${ping.type.toUpperCase()}</span>\n          ${canDelete ? `<button class=\"ping-delete-btn\" onclick=\"window.deletePing('${ping.id}')\" title=\"Delete this ping\">üóëÔ∏è</button>` : ''}\n        </div>\n        <div class=\"ping-popup-user\">üë§ ${ping.username || 'Anonymous'}</div>\n        ${ping.message ? `<div class=\"ping-popup-message\">${ping.message}</div>` : ''}\n        <div class=\"ping-popup-time\">${timeWithRelative}</div>\n      </div>\n    `\n  }\n\n  return <div ref={mapRef} className=\"map-container\" />\n}\n\nexport default MapComponent"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}