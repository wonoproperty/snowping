{"ast":null,"code":"export class WebSocketFactory {\n  /**\n   * Dynamic require that works in both CJS and ESM environments\n   * Bulletproof against strict ESM environments where require might not be in scope\n   * @private\n   */\n  static dynamicRequire(moduleId) {\n    try {\n      // Check if we're in a Node.js environment first\n      if (typeof process !== 'undefined' && process.versions && process.versions.node) {\n        // In Node.js, both CJS and ESM support require for dynamic imports\n        // Wrap in try/catch to handle strict ESM environments\n        if (typeof require !== 'undefined') {\n          return require(moduleId);\n        }\n      }\n      return null;\n    } catch (_a) {\n      // Catches any error from typeof require OR require() call in strict ESM\n      return null;\n    }\n  }\n  static detectEnvironment() {\n    var _a, _b;\n    if (typeof WebSocket !== 'undefined') {\n      return {\n        type: 'native',\n        constructor: WebSocket\n      };\n    }\n    if (typeof globalThis !== 'undefined' && typeof globalThis.WebSocket !== 'undefined') {\n      return {\n        type: 'native',\n        constructor: globalThis.WebSocket\n      };\n    }\n    if (typeof global !== 'undefined' && typeof global.WebSocket !== 'undefined') {\n      return {\n        type: 'native',\n        constructor: global.WebSocket\n      };\n    }\n    if (typeof globalThis !== 'undefined' && typeof globalThis.WebSocketPair !== 'undefined' && typeof globalThis.WebSocket === 'undefined') {\n      return {\n        type: 'cloudflare',\n        error: 'Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.',\n        workaround: 'Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime.'\n      };\n    }\n    if (typeof globalThis !== 'undefined' && globalThis.EdgeRuntime || typeof navigator !== 'undefined' && ((_a = navigator.userAgent) === null || _a === void 0 ? void 0 : _a.includes('Vercel-Edge'))) {\n      return {\n        type: 'unsupported',\n        error: 'Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.',\n        workaround: 'Use serverless functions or a different deployment target for WebSocket functionality.'\n      };\n    }\n    if (typeof process !== 'undefined' && process.versions && process.versions.node) {\n      const nodeVersion = parseInt(process.versions.node.split('.')[0]);\n      if (nodeVersion >= 22) {\n        try {\n          if (typeof globalThis.WebSocket !== 'undefined') {\n            return {\n              type: 'native',\n              constructor: globalThis.WebSocket\n            };\n          }\n          const undici = this.dynamicRequire('undici');\n          if (undici && undici.WebSocket) {\n            return {\n              type: 'native',\n              constructor: undici.WebSocket\n            };\n          }\n          throw new Error('undici not available');\n        } catch (err) {\n          return {\n            type: 'unsupported',\n            error: `Node.js ${nodeVersion} detected but native WebSocket not found.`,\n            workaround: 'Install the \"ws\" package or check your Node.js installation.'\n          };\n        }\n      }\n      try {\n        // Use dynamic require to work in both CJS and ESM environments\n        const ws = this.dynamicRequire('ws');\n        if (ws) {\n          return {\n            type: 'ws',\n            constructor: (_b = ws.WebSocket) !== null && _b !== void 0 ? _b : ws\n          };\n        }\n        throw new Error('ws package not available');\n      } catch (err) {\n        return {\n          type: 'unsupported',\n          error: `Node.js ${nodeVersion} detected without WebSocket support.`,\n          workaround: 'Install the \"ws\" package: npm install ws'\n        };\n      }\n    }\n    return {\n      type: 'unsupported',\n      error: 'Unknown JavaScript runtime without WebSocket support.',\n      workaround: \"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation.\"\n    };\n  }\n  static getWebSocketConstructor() {\n    const env = this.detectEnvironment();\n    if (env.constructor) {\n      return env.constructor;\n    }\n    let errorMessage = env.error || 'WebSocket not supported in this environment.';\n    if (env.workaround) {\n      errorMessage += `\\n\\nSuggested solution: ${env.workaround}`;\n    }\n    throw new Error(errorMessage);\n  }\n  static createWebSocket(url, protocols) {\n    const WS = this.getWebSocketConstructor();\n    return new WS(url, protocols);\n  }\n  static isWebSocketSupported() {\n    try {\n      const env = this.detectEnvironment();\n      return env.type === 'native' || env.type === 'ws';\n    } catch (_a) {\n      return false;\n    }\n  }\n}\nexport default WebSocketFactory;","map":{"version":3,"names":["WebSocketFactory","dynamicRequire","moduleId","process","versions","node","require","_a","detectEnvironment","WebSocket","type","constructor","globalThis","global","WebSocketPair","error","workaround","EdgeRuntime","navigator","userAgent","includes","nodeVersion","parseInt","split","undici","Error","err","ws","_b","getWebSocketConstructor","env","errorMessage","createWebSocket","url","protocols","WS","isWebSocketSupported"],"sources":["/Users/jwono/Downloads/snowping-pwa/node_modules/@supabase/realtime-js/src/lib/websocket-factory.ts"],"sourcesContent":["export interface WebSocketLike {\n  readonly CONNECTING: number\n  readonly OPEN: number\n  readonly CLOSING: number\n  readonly CLOSED: number\n  readonly readyState: number\n  readonly url: string\n  readonly protocol: string\n\n  close(code?: number, reason?: string): void\n  send(data: string | ArrayBufferLike | Blob | ArrayBufferView): void\n\n  onopen: ((this: any, ev: Event) => any) | null\n  onmessage: ((this: any, ev: MessageEvent) => any) | null\n  onclose: ((this: any, ev: CloseEvent) => any) | null\n  onerror: ((this: any, ev: Event) => any) | null\n\n  addEventListener(type: string, listener: EventListener): void\n  removeEventListener(type: string, listener: EventListener): void\n\n  // Add additional properties that may exist on WebSocket implementations\n  binaryType?: string\n  bufferedAmount?: number\n  extensions?: string\n  dispatchEvent?: (event: Event) => boolean\n}\n\nexport interface WebSocketEnvironment {\n  type: 'native' | 'ws' | 'cloudflare' | 'unsupported'\n  constructor?: any\n  error?: string\n  workaround?: string\n}\n\nexport class WebSocketFactory {\n  /**\n   * Dynamic require that works in both CJS and ESM environments\n   * Bulletproof against strict ESM environments where require might not be in scope\n   * @private\n   */\n  private static dynamicRequire(moduleId: string): any {\n    try {\n      // Check if we're in a Node.js environment first\n      if (\n        typeof process !== 'undefined' &&\n        process.versions &&\n        process.versions.node\n      ) {\n        // In Node.js, both CJS and ESM support require for dynamic imports\n        // Wrap in try/catch to handle strict ESM environments\n        if (typeof require !== 'undefined') {\n          return require(moduleId)\n        }\n      }\n      return null\n    } catch {\n      // Catches any error from typeof require OR require() call in strict ESM\n      return null\n    }\n  }\n\n  private static detectEnvironment(): WebSocketEnvironment {\n    if (typeof WebSocket !== 'undefined') {\n      return { type: 'native', constructor: WebSocket }\n    }\n\n    if (\n      typeof globalThis !== 'undefined' &&\n      typeof (globalThis as any).WebSocket !== 'undefined'\n    ) {\n      return { type: 'native', constructor: (globalThis as any).WebSocket }\n    }\n\n    if (\n      typeof global !== 'undefined' &&\n      typeof (global as any).WebSocket !== 'undefined'\n    ) {\n      return { type: 'native', constructor: (global as any).WebSocket }\n    }\n\n    if (\n      typeof globalThis !== 'undefined' &&\n      typeof (globalThis as any).WebSocketPair !== 'undefined' &&\n      typeof globalThis.WebSocket === 'undefined'\n    ) {\n      return {\n        type: 'cloudflare',\n        error:\n          'Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.',\n        workaround:\n          'Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime.',\n      }\n    }\n\n    if (\n      (typeof globalThis !== 'undefined' && (globalThis as any).EdgeRuntime) ||\n      (typeof navigator !== 'undefined' &&\n        navigator.userAgent?.includes('Vercel-Edge'))\n    ) {\n      return {\n        type: 'unsupported',\n        error:\n          'Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.',\n        workaround:\n          'Use serverless functions or a different deployment target for WebSocket functionality.',\n      }\n    }\n\n    if (\n      typeof process !== 'undefined' &&\n      process.versions &&\n      process.versions.node\n    ) {\n      const nodeVersion = parseInt(process.versions.node.split('.')[0])\n      if (nodeVersion >= 22) {\n        try {\n          if (typeof globalThis.WebSocket !== 'undefined') {\n            return { type: 'native', constructor: globalThis.WebSocket }\n          }\n          const undici = this.dynamicRequire('undici')\n          if (undici && undici.WebSocket) {\n            return { type: 'native', constructor: undici.WebSocket }\n          }\n          throw new Error('undici not available')\n        } catch (err) {\n          return {\n            type: 'unsupported',\n            error: `Node.js ${nodeVersion} detected but native WebSocket not found.`,\n            workaround:\n              'Install the \"ws\" package or check your Node.js installation.',\n          }\n        }\n      }\n      try {\n        // Use dynamic require to work in both CJS and ESM environments\n        const ws = this.dynamicRequire('ws')\n        if (ws) {\n          return { type: 'ws', constructor: ws.WebSocket ?? ws }\n        }\n        throw new Error('ws package not available')\n      } catch (err) {\n        return {\n          type: 'unsupported',\n          error: `Node.js ${nodeVersion} detected without WebSocket support.`,\n          workaround: 'Install the \"ws\" package: npm install ws',\n        }\n      }\n    }\n\n    return {\n      type: 'unsupported',\n      error: 'Unknown JavaScript runtime without WebSocket support.',\n      workaround:\n        \"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation.\",\n    }\n  }\n\n  public static getWebSocketConstructor(): typeof WebSocket {\n    const env = this.detectEnvironment()\n    if (env.constructor) {\n      return env.constructor\n    }\n    let errorMessage =\n      env.error || 'WebSocket not supported in this environment.'\n    if (env.workaround) {\n      errorMessage += `\\n\\nSuggested solution: ${env.workaround}`\n    }\n    throw new Error(errorMessage)\n  }\n\n  public static createWebSocket(\n    url: string | URL,\n    protocols?: string | string[]\n  ): WebSocketLike {\n    const WS = this.getWebSocketConstructor()\n    return new WS(url, protocols)\n  }\n\n  public static isWebSocketSupported(): boolean {\n    try {\n      const env = this.detectEnvironment()\n      return env.type === 'native' || env.type === 'ws'\n    } catch {\n      return false\n    }\n  }\n}\n\nexport default WebSocketFactory\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}