{"ast":null,"code":"import React,{useEffect,useRef}from'react';import L from'leaflet';import'leaflet/dist/leaflet.css';import'./MapComponent.css';import{formatDateTimeWithRelative}from'../utils/timeUtils';// Fix for default markers in Leaflet with React\nimport{jsx as _jsx}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',iconUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png'});const MapComponent=_ref=>{let{pings=[],currentUserId,onDeletePing}=_ref;const mapRef=useRef(null);const mapInstanceRef=useRef(null);const markersRef=useRef([]);useEffect(()=>{if(!mapInstanceRef.current&&mapRef.current){// Initialize map\nmapInstanceRef.current=L.map(mapRef.current).setView([-37.1,147.1],13);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors',maxZoom:18}).addTo(mapInstanceRef.current);}// Set up global delete function for popup buttons\nwindow.deletePing=pingId=>{if(window.confirm('Are you sure you want to delete this ping?')){onDeletePing(pingId);}};return()=>{if(mapInstanceRef.current){mapInstanceRef.current.remove();mapInstanceRef.current=null;}// Clean up global function\ndelete window.deletePing;};},[onDeletePing]);useEffect(()=>{if(!mapInstanceRef.current)return;// Clear existing markers\nmarkersRef.current.forEach(marker=>{mapInstanceRef.current.removeLayer(marker);});markersRef.current=[];// Add new markers\npings.forEach(ping=>{const icon=getPingIcon(ping.type);const marker=L.marker([ping.latitude,ping.longitude],{icon}).addTo(mapInstanceRef.current).bindPopup(createPopupContent(ping));markersRef.current.push(marker);});// Auto-fit map to show all pings\nif(pings.length>0){const group=new L.featureGroup(markersRef.current);mapInstanceRef.current.fitBounds(group.getBounds().pad(0.1));}},[pings]);const getPingIcon=type=>{const iconConfig={iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]};switch(type){case'here':return L.divIcon({...iconConfig,html:'<div class=\"ping-marker ping-here\">üìç</div>',className:'custom-ping-icon'});case'meet':return L.divIcon({...iconConfig,html:'<div class=\"ping-marker ping-meet\">ü§ù</div>',className:'custom-ping-icon'});case'sos':return L.divIcon({...iconConfig,html:'<div class=\"ping-marker ping-sos\">üÜò</div>',className:'custom-ping-icon'});default:return new L.Icon.Default();}};const createPopupContent=ping=>{const timeWithRelative=formatDateTimeWithRelative(ping.timestamp);const typeEmoji={here:'üìç',meet:'ü§ù',sos:'üÜò'};const isOwnPing=ping.user_id===currentUserId;const canDelete=isOwnPing&&(ping.type==='here'||ping.type==='meet');return`\n      <div class=\"ping-popup\" data-ping-id=\"${ping.id}\">\n        <div class=\"ping-popup-header\">\n          <span class=\"ping-popup-icon\">${typeEmoji[ping.type]||'üìç'}</span>\n          <span class=\"ping-popup-type\">${ping.type.toUpperCase()}</span>\n          ${canDelete?`<button class=\"ping-delete-btn\" onclick=\"window.deletePing('${ping.id}')\" title=\"Delete this ping\">üóëÔ∏è</button>`:''}\n        </div>\n        <div class=\"ping-popup-user\">üë§ ${ping.username||'Anonymous'}</div>\n        ${ping.message?`<div class=\"ping-popup-message\">${ping.message}</div>`:''}\n        <div class=\"ping-popup-time\">${timeWithRelative}</div>\n      </div>\n    `;};return/*#__PURE__*/_jsx(\"div\",{ref:mapRef,className:\"map-container\"});};export default MapComponent;","map":{"version":3,"names":["React","useEffect","useRef","L","formatDateTimeWithRelative","jsx","_jsx","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","MapComponent","_ref","pings","currentUserId","onDeletePing","mapRef","mapInstanceRef","markersRef","current","map","setView","tileLayer","attribution","maxZoom","addTo","window","deletePing","pingId","confirm","remove","forEach","marker","removeLayer","ping","icon","getPingIcon","type","latitude","longitude","bindPopup","createPopupContent","push","length","group","featureGroup","fitBounds","getBounds","pad","iconConfig","iconSize","iconAnchor","popupAnchor","divIcon","html","className","timeWithRelative","timestamp","typeEmoji","here","meet","sos","isOwnPing","user_id","canDelete","id","toUpperCase","username","message","ref"],"sources":["/Users/jwono/Downloads/snowping-pwa/src/components/MapComponent.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react'\nimport L from 'leaflet'\nimport 'leaflet/dist/leaflet.css'\nimport './MapComponent.css'\nimport { formatDateTimeWithRelative } from '../utils/timeUtils'\n\n// Fix for default markers in Leaflet with React\ndelete L.Icon.Default.prototype._getIconUrl\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n})\n\nconst MapComponent = ({ pings = [], currentUserId, onDeletePing }) => {\n  const mapRef = useRef(null)\n  const mapInstanceRef = useRef(null)\n  const markersRef = useRef([])\n\n  useEffect(() => {\n    if (!mapInstanceRef.current && mapRef.current) {\n      // Initialize map\n      mapInstanceRef.current = L.map(mapRef.current).setView([-37.1, 147.1], 13)\n      \n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '¬© OpenStreetMap contributors',\n        maxZoom: 18,\n      }).addTo(mapInstanceRef.current)\n    }\n\n    // Set up global delete function for popup buttons\n    window.deletePing = (pingId) => {\n      if (window.confirm('Are you sure you want to delete this ping?')) {\n        onDeletePing(pingId)\n      }\n    }\n\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove()\n        mapInstanceRef.current = null\n      }\n      // Clean up global function\n      delete window.deletePing\n    }\n  }, [onDeletePing])\n\n  useEffect(() => {\n    if (!mapInstanceRef.current) return\n\n    // Clear existing markers\n    markersRef.current.forEach(marker => {\n      mapInstanceRef.current.removeLayer(marker)\n    })\n    markersRef.current = []\n\n    // Add new markers\n    pings.forEach(ping => {\n      const icon = getPingIcon(ping.type)\n      const marker = L.marker([ping.latitude, ping.longitude], { icon })\n        .addTo(mapInstanceRef.current)\n        .bindPopup(createPopupContent(ping))\n\n      markersRef.current.push(marker)\n    })\n\n    // Auto-fit map to show all pings\n    if (pings.length > 0) {\n      const group = new L.featureGroup(markersRef.current)\n      mapInstanceRef.current.fitBounds(group.getBounds().pad(0.1))\n    }\n  }, [pings])\n\n  const getPingIcon = (type) => {\n    const iconConfig = {\n      iconSize: [32, 32],\n      iconAnchor: [16, 32],\n      popupAnchor: [0, -32],\n    }\n\n    switch (type) {\n      case 'here':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-here\">üìç</div>',\n          className: 'custom-ping-icon'\n        })\n      case 'meet':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-meet\">ü§ù</div>',\n          className: 'custom-ping-icon'\n        })\n      case 'sos':\n        return L.divIcon({\n          ...iconConfig,\n          html: '<div class=\"ping-marker ping-sos\">üÜò</div>',\n          className: 'custom-ping-icon'\n        })\n      default:\n        return new L.Icon.Default()\n    }\n  }\n\n  const createPopupContent = (ping) => {\n    const timeWithRelative = formatDateTimeWithRelative(ping.timestamp)\n    const typeEmoji = {\n      here: 'üìç',\n      meet: 'ü§ù',\n      sos: 'üÜò'\n    }\n    \n    const isOwnPing = ping.user_id === currentUserId\n    const canDelete = isOwnPing && (ping.type === 'here' || ping.type === 'meet')\n    \n    return `\n      <div class=\"ping-popup\" data-ping-id=\"${ping.id}\">\n        <div class=\"ping-popup-header\">\n          <span class=\"ping-popup-icon\">${typeEmoji[ping.type] || 'üìç'}</span>\n          <span class=\"ping-popup-type\">${ping.type.toUpperCase()}</span>\n          ${canDelete ? `<button class=\"ping-delete-btn\" onclick=\"window.deletePing('${ping.id}')\" title=\"Delete this ping\">üóëÔ∏è</button>` : ''}\n        </div>\n        <div class=\"ping-popup-user\">üë§ ${ping.username || 'Anonymous'}</div>\n        ${ping.message ? `<div class=\"ping-popup-message\">${ping.message}</div>` : ''}\n        <div class=\"ping-popup-time\">${timeWithRelative}</div>\n      </div>\n    `\n  }\n\n  return <div ref={mapRef} className=\"map-container\" />\n}\n\nexport default MapComponent"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}